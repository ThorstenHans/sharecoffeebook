#ShareCoffee.REST

Finally SharePoint 2013 is offering a OData conform REST API, which enables developers to use OData url query operations in order to directly access data from SharePoint.

As mentioned in Chapter 2, there are many different ways how REST queries have to be executed depending on the current context. This fact was a little bit frustrating when diging into SharePoint App Development.

ShareCoffee is providing a clean, fluent API for building REST queries. `ShareCoffee.REST.build` is the global entry-point for creating REST properties. Depending on your intent, you can choose one of the following operations

  * Create
  * Read
  * Update
  * Delete

which are reflecting the famous CRUD operations. 

    ShareCoffee.REST.build.create
    ShareCoffee.REST.build.read
    ShareCoffee.REST.build.update
    ShareCoffee.REST.build.delete


In order to support all the following JavaScript frameworks

  * jQuery
  * AngularJS
  * reqwest

You've to specify which framework you're currently using, prefixed by the `for` property

    // AngularJS samples
    ShareCoffee.REST.build.create.for.angularJS()
    ShareCoffee.REST.build.read.for.angularJS()
    ShareCoffee.REST.build.update.for.angularJS()
    ShareCoffee.REST.build.delete.for.angularJS()

    // jQuery samples
    ShareCoffee.REST.build.create.for.jQuery()
    ShareCoffee.REST.build.read.for.jQuery()
    ShareCoffee.REST.build.update.for.jQuery()
    ShareCoffee.REST.build.delete.for.jQuery()

    // reqwest samples
    ShareCoffee.REST.build.create.for.reqwest()
    ShareCoffee.REST.build.read.for.reqwest()
    ShareCoffee.REST.build.update.for.reqwest()
    ShareCoffee.REST.build.delete.for.reqwest()

T> ## IE 8 workaround
T> IE8 is supported by SharePoint 2013 OnPremise, if you're targeting this browser, you've to replace the **for** property by the **f** shorthand.
T> IE9 is not able to execute a function or access a proprety called **for**


## Providing REST Properties

Now you've seen ShareCoffee's entire API, there is only one thing missing : The REST operation configuration. ShareCoffee is providing some cool features, which will help you building exactly these configurations.

Let's start with a simple example (All the samples assume that you're using jQuery). Let's say you'd like to read all the ContentTypes available on the AppWeb. So by definition it's a **read** operation, ContentTypes are available on web level, so we have to build a REST query which pulls out the ContentTypes from

`https://myapp.mytenant.sharepoint.com/sites/MyTeamSite/MyApp/_api/web/ContentTypes`

    var options = {
      url: 'web/ContentTypes'
    };
    $.ajax(ShareCoffee.REST.build.read.for.jQuery(options))
    .done(onSuccess)
    .fail(onError);

In the sample code above we've only specified a part of the entire url, this is working because ShareCoffee is internally concatting the url you provide to `ShareCoffee.Commons.getApiRootUrl()`. Beside this, ShareCoffee knows that you're executing a GET query and working on the AppWeb, so it's able to extend the HTTP Request by all the headers required to successfully executing such a read operation against the AppWeb. The sample above can also be writtin like this

    $.ajax(ShareCoffee.REST.build.read.for.jQuery({url: 'web/ContentTypes'}))
    .done(onSuccess)
    .fail(onError);


## JSONLight support in Office365

In August 2014, Microsoft announced the general availability of JSONLight support for SharePoint Online's REST API. JSONLight support is also backed into ShareCoffee. 

W> ## Currently no OnPremise support
W> When writing this book, there were no information on JSONLight support for SharePoint 2013 OnPremise. 

ShareCoffee 0.1.1 is offering an easy way to change REST response style from the default `odata=verbose` to one of the following

  * minimal `odata=minimalmetadata`
  * no metadata `odata=nometadata`

ShareCoffee is exposing a single property which will control this for all the queries you're executing.

    ShareCoffee.jsonRequestBehavior

`ShareCoffee.jsonRequestBehavior` is defaulting to `odata=verbose` which will also work for all SharePoint OnPremise installations.

See the short sample below, which demonstrates how to use `ShareCoffee.JsonRequestBehaviors` object in order to change the behavior easily

    ShareCoffee.jsonRequestBehavior = ShareCoffee.JsonRequstBehaviors.minimal
    # all requests will send odata=minimalmetadata as Accept header

    ShareCoffee.jsonRequestBehavior = ShareCoffee.JsonRequstBehaviors.nometadata
    # all requests will send odata=nometadata as Accept header

    ShareCoffee.jsonRequestBehavior = ShareCoffee.JsonRequstBehaviors.verbose
    # all requests will send odata=verbose as Accept header

    ShareCoffee.jsonRequestBehavior = ShareCoffee.JsonRequstBehaviors.default
    # all requests will send odata=verbose as Accept header


See [this article on blogs.office.com](http://blogs.office.com/2014/08/13/json-light-support-rest-sharepoint-api-released/) which describes how REST responses will reflect this setting.
    